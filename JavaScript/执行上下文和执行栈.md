# 执行上下文和执行栈

## 执行上下文

> 评估和执行JavaScript代码的环境的抽象概念

#### 执行上下文的类型

+ 全局执行上下文：任何不在函数内部的代码都在全局上下文中

  创建一个全局的global对象或window对象，this指向全局对象，一个程序只会有一个全局上下文，因此也只会有一个全局对象

+ 函数执行上下文

  当一个函数被调用时，就会为该函数创建一个新的上下文。每个函数都有它自己的执行上下文，不过是在函数被调用时创建。

  函数上下文可以有任意多个，每当一个被创建时，会按定义的顺序执行一些步骤

+ Eval函数执行上下文：执行在eval函数内部的代码有自己的执行上下文

#### 执行栈

> 也就是调用栈，用来存储代码运行时创建的所有上下文，LIFO先进后出
>
> 不管是什么程序，全局上下文永远是最先进入执行栈的，最后出执行栈的
>
> 每当引擎遇到一个函数调用，会为该函数创建一个新的执行上下文并压入栈顶部
>
> 引擎会执行栈顶的执行上下文，当函数执行结束时，弹出栈顶顶执行上下文，执行下一个

#### 如何创建执行上下文

> 分为创建阶段和执行阶段
>
> + 创建阶段：
>
>   + 绑定this
>
>     + 在全局中，this指向global或window
>     + 在函数中，this值取决于函数是如何被调用的，如果被引用对象调用，指向该对象，否则指向全局对象或undefined
>
>   + 创建语法环境组件
>
>     + 环境记录器：存储变量和函数声明的实际位置
>     + 外部环境的引用：可以访问父级词法作用域
>
>     对于函数环境，声明式环境记录器包含了一个函数内部的arguments对象，和传递给函数的参数的length：fn.length
>
>   + 创建变量环境组件
>
>     词法环境组件和变量环境的不同就是前者用来存储函数变量和声明let和const绑定，后者用来存储var变量绑定
>
> + 执行阶段
>
>   完成对所有变量的分配，最后执行代码
>
>   在执行阶段，如果找不到let变量的值，被复制为undefined，但是const变量是被要求必须初始化的



































